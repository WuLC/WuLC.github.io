<!doctype html><html lang=zh-CN><meta charset=UTF-8><meta content="width=device-width" name=viewport><meta content=#222 name=theme-color><meta content="Hexo 7.3.0" name=generator><link href=/imgs/favicon.ico rel=apple-touch-icon sizes=180x180><link href=/imgs/favicon.ico rel=icon sizes=32x32 type=image/png><link href=/imgs/favicon.ico rel=icon sizes=16x16 type=image/png><link color=#222 href=/imgs/favicon.ico rel=mask-icon><meta content=VcC-PHB4Om9SIR3Roqm7k1N-SHiBtQ6c3LJLVMKgU4U name=google-site-verification><meta content=cc79d2405dbf4293a4d12323dfb8ef24 name=msvalidate.01><meta content=z0l07oey8Mtx46FB name=baidu-site-verification><style>:root{--body-bg-color:#f5f7f9;--content-bg-color:#fff;--card-bg-color:#f5f5f5;--text-color:#555;--selection-bg:#262a30;--selection-color:#eee;--blockquote-color:#666;--link-color:#555;--link-hover-color:#222;--brand-color:#fff;--brand-hover-color:#fff;--table-row-odd-bg-color:#f9f9f9;--table-row-hover-bg-color:#f5f5f5;--menu-item-bg-color:#f5f5f5;--theme-color:#222;--btn-default-bg:#fff;--btn-default-color:#555;--btn-default-border-color:#555;--btn-default-hover-bg:#222;--btn-default-hover-color:#fff;--btn-default-hover-border-color:#222;--highlight-background:#f3f3f3;--highlight-foreground:#444;--highlight-gutter-background:#e1e1e1;--highlight-gutter-foreground:#555;color-scheme:light}html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{margin:.67em 0;font-size:2em}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace;font-size:1em}a{background:0 0}abbr[title]{border-bottom:none;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace;font-size:1em}small{font-size:80%}sub,sup{vertical-align:baseline;font-size:75%;line-height:0;position:relative}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:100%;line-height:1.15}button,input{overflow:visible}button,select{text-transform:none}button,[type=button],[type=reset],[type=submit]{-webkit-appearance:button}button::-moz-focus-inner,[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring{outline:1px dotted buttontext}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;white-space:normal;max-width:100%;padding:0;display:table}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}details{display:block}summary{display:list-item}template,[hidden]{display:none}::selection{background:var(--selection-bg);color:var(--selection-color)}html,body{height:100%}body{background:var(--body-bg-color);box-sizing:border-box;color:var(--text-color);min-height:100%;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:1em;line-height:2;transition:padding .2s ease-in-out;position:relative}h1,h2,h3,h4,h5,h6{margin:30px 0 15px;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-weight:700;line-height:1.5}h1{font-size:1.5em}h2{font-size:1.375em}h3{font-size:1.25em}h4{font-size:1.125em}h5{font-size:1em}h6{font-size:.875em}a{color:var(--link-color);cursor:pointer;overflow-wrap:break-word;border-bottom:1px solid #999;outline:0;text-decoration:none}a:hover{border-bottom-color:var(--link-hover-color);color:var(--link-hover-color)}iframe,img,video,embed{max-width:100%;margin-left:auto;margin-right:auto;display:block}hr{background-image:repeating-linear-gradient(-45deg,#ddd,#ddd 4px,#0000 4px 8px);border:0;height:3px;margin:40px 0}blockquote{color:var(--blockquote-color);border-left:4px solid #ddd;margin:0;padding:0 15px}blockquote cite:before{content:"-";padding:0 5px}dt{font-weight:700}dd{margin:0;padding:0}.table-container{overflow:auto}table{border-collapse:collapse;border-spacing:0;width:100%;margin:0 0 20px;font-size:.875em}tbody tr:nth-of-type(odd){background:var(--table-row-odd-bg-color)}tbody tr:hover{background:var(--table-row-hover-bg-color)}caption,th,td{padding:8px}th,td{border:1px solid #ddd;border-bottom-width:3px}th{padding-bottom:10px;font-weight:700}td{border-bottom-width:1px}.btn{background:var(--btn-default-bg);border:2px solid var(--btn-default-border-color);color:var(--btn-default-color);border-radius:2px;padding:0 20px;font-size:.875em;line-height:2;transition:background-color .2s ease-in-out;display:inline-block}.btn:hover{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.btn+.btn{margin:0 0 8px 8px}.btn .fa-fw{text-align:left;width:1.28571em}.toggle{line-height:0}.toggle .toggle-line{background:#fff;width:100%;height:2px;transition:left .4s,opacity .4s,top .4s,transform .4s,width .4s;display:block;position:relative;top:0;left:0}.toggle .toggle-line:first-child{margin-top:1px}.toggle .toggle-line:not(:first-child){margin-top:4px}.toggle.toggle-arrow :first-child{width:50%;top:2px;left:50%;transform:rotate(45deg)}.toggle.toggle-arrow :last-child{width:50%;top:-2px;left:50%;transform:rotate(-45deg)}.toggle.toggle-close :nth-child(2){opacity:0}.toggle.toggle-close :first-child{top:6px;transform:rotate(45deg)}.toggle.toggle-close :last-child{top:-6px;transform:rotate(-45deg)}pre code.hljs{padding:1em;display:block;overflow-x:auto}code.hljs{padding:3px 5px}.hljs{color:#444;background:#f3f3f3}.hljs-comment{color:#697070}.hljs-tag,.hljs-punctuation{color:#444a}.hljs-tag .hljs-name,.hljs-tag .hljs-attr{color:#444}.hljs-keyword,.hljs-attribute,.hljs-selector-tag,.hljs-meta .hljs-keyword,.hljs-doctag,.hljs-name{font-weight:700}.hljs-type,.hljs-string,.hljs-number,.hljs-selector-id,.hljs-selector-class,.hljs-quote,.hljs-template-tag,.hljs-deletion{color:#800}.hljs-title,.hljs-section{color:#800;font-weight:700}.hljs-regexp,.hljs-symbol,.hljs-variable,.hljs-template-variable,.hljs-link,.hljs-selector-attr,.hljs-operator,.hljs-selector-pseudo{color:#ab5656}.hljs-literal{color:#695}.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-addition{color:#397300}.hljs-meta{color:#1f7199}.hljs-meta .hljs-string{color:#38a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.highlight:hover .copy-btn,.code-container:hover .copy-btn{opacity:1}.code-container{position:relative}.code-lang{opacity:.1;pointer-events:none;font-size:40px;line-height:1;position:absolute;right:5px}.copy-btn{color:#333;cursor:pointer;opacity:0;background:#fff;border:0;padding:2px 6px;font-size:.8125em;line-height:1.6;transition:opacity .2s ease-in-out;position:absolute;top:0;right:0}code,kbd,figure.highlight,pre{background:var(--highlight-background);color:var(--highlight-foreground)}figure.highlight,pre{margin:0 auto 20px;line-height:1.6}figure.highlight figcaption,pre .caption{background:var(--highlight-gutter-background);color:var(--highlight-foreground);padding:.5em;font-size:.875em;line-height:1.2;display:flow-root}figure.highlight figcaption a,pre .caption a{color:var(--highlight-foreground);float:right}figure.highlight figcaption a:hover,pre .caption a:hover{border-bottom-color:var(--highlight-foreground)}pre,code{font-family:consolas,Menlo,monospace,PingFang SC,Microsoft YaHei}code{overflow-wrap:break-word;border-radius:3px;padding:2px 4px;font-size:.875em}kbd{white-space:nowrap;border:2px solid #ccc;border-radius:.2em;padding:.1em .3em;font-family:inherit;box-shadow:.1em .1em .2em #0000001a}figure.highlight{position:relative;overflow:auto}figure.highlight pre{border:0;margin:0;padding:10px 0}figure.highlight table{border:0;width:auto;margin:0}figure.highlight td{border:0;padding:0}figure.highlight .gutter{-webkit-user-select:none;user-select:none}figure.highlight .gutter pre{background:var(--highlight-gutter-background);color:var(--highlight-gutter-foreground);text-align:right;padding-left:10px;padding-right:10px}figure.highlight .code pre{width:100%;padding-left:10px}figure.highlight .marked{background:#0000004d}pre .caption{margin-bottom:10px}.gist table{width:auto}.gist table td{border:0}pre{padding:10px;overflow:auto}pre code{text-shadow:none;background:0 0;padding:0}.blockquote-center{text-align:center;border-left:0;margin:40px 0;padding:0;position:relative}.blockquote-center:before,.blockquote-center:after{opacity:.6;width:100%;line-height:1;position:absolute;left:0}.blockquote-center:before{text-align:left;content:"";border-top:1px solid #ccc;font-family:"Font Awesome 7 Free";font-weight:900;top:-20px}.blockquote-center:after{text-align:right;content:"";border-bottom:1px solid #ccc;font-family:"Font Awesome 7 Free";font-weight:900;bottom:-20px}.blockquote-center p,.blockquote-center div{text-align:center}.group-picture{margin-bottom:20px}.group-picture .group-picture-row{gap:3px;margin-bottom:3px;display:flex}.group-picture .group-picture-column{flex:1}.group-picture .group-picture-column img{object-fit:cover;width:100%;height:100%;margin:0}.post-body .label{color:#555;padding:0 2px}.post-body .label.default{background:#f0f0f0}.post-body .label.primary{background:#efe6f7}.post-body .label.info{background:#e5f2f8}.post-body .label.success{background:#e7f4e9}.post-body .label.warning{background:#fcf6e1}.post-body .label.danger{background:#fae8eb}.post-body .link-grid{grid-gap:1.5rem;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;margin-bottom:20px;padding:1rem;display:grid}.post-body .link-grid .link-grid-container{border:solid #ddd;min-width:0;min-height:5rem;padding:.5rem;transition:background .3s;position:relative;box-shadow:1rem 1rem .5rem #00000080}.post-body .link-grid .link-grid-container:hover{background:var(--card-bg-color);animation:.5s next-shake}.post-body .link-grid .link-grid-container:active{transform:translate(.2rem,.2rem);box-shadow:.5rem .5rem .25rem #00000080}.post-body .link-grid .link-grid-container .link-grid-image{box-sizing:border-box;border:1px solid #ddd;border-radius:50%;width:5rem;height:5rem;padding:3px;position:absolute}.post-body .link-grid .link-grid-container p{margin:0 1rem 0 6rem}.post-body .link-grid .link-grid-container p:first-of-type{font-size:1.2em}.post-body .link-grid .link-grid-container p:last-of-type{opacity:.7;font-size:.8em;line-height:1.3rem}.post-body .link-grid .link-grid-container a{border:0;width:100%;height:100%;position:absolute;top:0;left:0}@keyframes next-shake{0%{transform:translate(1pt,1pt)rotate(0)}10%{transform:translate(-1pt,-2pt)rotate(-1deg)}20%{transform:translate(-3pt)rotate(1deg)}30%{transform:translate(3pt,2pt)rotate(0)}40%{transform:translate(1pt,-1pt)rotate(1deg)}50%{transform:translate(-1pt,2pt)rotate(-1deg)}60%{transform:translate(-3pt,1pt)rotate(0)}70%{transform:translate(3pt,1pt)rotate(-1deg)}80%{transform:translate(-1pt,-1pt)rotate(1deg)}90%{transform:translate(1pt,2pt)rotate(0)}to{transform:translate(1pt,-2pt)rotate(-1deg)}}.post-body .note{border:1px solid #eee;border-left-width:5px;border-radius:3px;margin-bottom:20px;padding:1em;position:relative}.post-body .note summary{cursor:pointer;outline:0}.post-body .note summary p{display:inline}.post-body .note h2,.post-body .note h3,.post-body .note h4,.post-body .note h5,.post-body .note h6{border-bottom:initial;margin:0;padding-top:0}.post-body .note :first-child{margin-top:0}.post-body .note :last-child{margin-bottom:0}.post-body .note.default{border-left-color:#777}.post-body .note.default h2,.post-body .note.default h3,.post-body .note.default h4,.post-body .note.default h5,.post-body .note.default h6{color:#777}.post-body .note.primary{border-left-color:#6f42c1}.post-body .note.primary h2,.post-body .note.primary h3,.post-body .note.primary h4,.post-body .note.primary h5,.post-body .note.primary h6{color:#6f42c1}.post-body .note.info{border-left-color:#428bca}.post-body .note.info h2,.post-body .note.info h3,.post-body .note.info h4,.post-body .note.info h5,.post-body .note.info h6{color:#428bca}.post-body .note.success{border-left-color:#5cb85c}.post-body .note.success h2,.post-body .note.success h3,.post-body .note.success h4,.post-body .note.success h5,.post-body .note.success h6{color:#5cb85c}.post-body .note.warning{border-left-color:#f0ad4e}.post-body .note.warning h2,.post-body .note.warning h3,.post-body .note.warning h4,.post-body .note.warning h5,.post-body .note.warning h6{color:#f0ad4e}.post-body .note.danger{border-left-color:#d9534f}.post-body .note.danger h2,.post-body .note.danger h3,.post-body .note.danger h4,.post-body .note.danger h5,.post-body .note.danger h6{color:#d9534f}.post-body .tabs{margin-bottom:20px}.post-body .tabs,.tabs-comment{padding-top:10px}.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{background:var(--content-bg-color);z-index:5;flex-wrap:wrap;justify-content:center;margin:0;padding:0;display:flex;position:sticky;top:0}@media (width<=413px){.post-body .tabs ul.nav-tabs,.tabs-comment ul.nav-tabs{margin-bottom:5px;display:block}}.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border:1px solid #0000;border-top-width:3px;border-bottom-color:#ddd;border-radius:0;flex-grow:1;list-style-type:none}@media (width<=413px){.post-body .tabs ul.nav-tabs li.tab,.tabs-comment ul.nav-tabs li.tab{border:1px solid #0000;border-left-width:3px;border-radius:0}}.post-body .tabs ul.nav-tabs li.tab a,.tabs-comment ul.nav-tabs li.tab a{border-bottom:initial;text-align:center;padding:.25em .75em;line-height:1.8;transition:all .2s ease-out;display:block}.post-body .tabs ul.nav-tabs li.tab a i[class^=fa],.tabs-comment ul.nav-tabs li.tab a i[class^=fa]{width:1.28571em}.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#fc6423 #ddd #0000}@media (width<=413px){.post-body .tabs ul.nav-tabs li.tab.active,.tabs-comment ul.nav-tabs li.tab.active{border-color:#ddd #ddd #ddd #fc6423}}.post-body .tabs ul.nav-tabs li.tab.active a,.tabs-comment ul.nav-tabs li.tab.active a{cursor:default}.post-body .tabs .tab-content,.tabs-comment .tab-content{border:1px solid #ddd;border-top-color:#0000;border-radius:0}@media (width<=413px){.post-body .tabs .tab-content,.tabs-comment .tab-content{border-top-color:#ddd;border-radius:0}}.post-body .tabs .tab-content .tab-pane,.tabs-comment .tab-content .tab-pane{padding:20px 20px 0}.post-body .tabs .tab-content .tab-pane:not(.active),.tabs-comment .tab-content .tab-pane:not(.active){display:none}.pagination .prev,.pagination .next,.pagination .page-number,.pagination .space{margin:-1px 10px 0;padding:0 10px;display:inline-block}@media (width<=767px){.pagination .prev,.pagination .next,.pagination .page-number,.pagination .space{margin:0 5px}}.pagination .page-number.current{color:var(--content-bg-color);background:#ccc;border-color:#ccc}.pagination{text-align:center;border-top:1px solid #eee;margin:120px 0 0}.pagination .prev,.pagination .next,.pagination .page-number{border-top:1px solid #eee;border-bottom:0;transition:border-color .2s ease-in-out}.pagination .prev:hover,.pagination .next:hover,.pagination .page-number:hover{border-top-color:var(--link-hover-color)}@media (width<=767px){.pagination{border-top:0}.pagination .prev,.pagination .next,.pagination .page-number{border-top:0;border-bottom:1px solid #eee}.pagination .prev:hover,.pagination .next:hover,.pagination .page-number:hover{border-bottom-color:var(--link-hover-color)}}.pagination .space{margin:0;padding:0}.comments{margin-top:60px;overflow:hidden}.comment-button-group{flex-wrap:wrap;justify-content:center;margin:1em 0;display:flex}.comment-button-group .comment-button{margin:.1em .2em}.comment-button-group .comment-button.active{background:var(--btn-default-hover-bg);border-color:var(--btn-default-hover-border-color);color:var(--btn-default-hover-color)}.comment-position{display:none}.comment-position.active{display:block}.tabs-comment{margin-top:4em;padding-top:0}.tabs-comment .comments{margin-top:0;padding-top:0}.headband{background:var(--theme-color);height:3px}@media (width<=991px){.headband{display:none}}.site-brand-container{flex-shrink:0;padding:0 10px;display:flex}.use-motion .column,.use-motion .site-brand-container .toggle{opacity:0}.site-meta{text-align:center;flex-grow:1}@media (width<=767px){.site-meta{text-align:center}}.custom-logo-image{margin-top:20px}@media (width<=991px){.custom-logo-image{display:none}}.brand{color:var(--brand-color);border-bottom:0;padding:0;display:inline-block}.brand:hover{color:var(--brand-hover-color)}.site-title{margin:0;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:1.375em;font-weight:400;line-height:1.5}.site-subtitle{color:#ddd;margin:10px 10px 0;font-size:.8125em}.use-motion .site-title,.use-motion .site-subtitle,.use-motion .custom-logo-image{opacity:0;position:relative;top:-10px}.site-nav-toggle,.site-nav-right{display:none}@media (width<=767px){.site-nav-toggle,.site-nav-right{flex-direction:column;justify-content:center;display:flex}}.site-nav-toggle .toggle,.site-nav-right .toggle{color:var(--text-color);width:22px;padding:10px}.site-nav-toggle .toggle .toggle-line,.site-nav-right .toggle .toggle-line{background:var(--text-color);border-radius:1px}@media (width<=767px){.site-nav{--scroll-height:0;visibility:hidden;height:0;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu{text-align:center;margin:0;padding:1em 0}.menu-item{margin:0 10px;list-style:none;display:inline-block}@media (width<=767px){.menu-item{margin-top:10px;display:block}.menu-item.menu-item-search{display:none}}.menu-item a{border-bottom:0;font-size:.8125em;transition:border-color .2s ease-in-out;display:block}.menu-item a:hover,.menu-item a.menu-item-active{background:var(--menu-item-bg-color)}.menu-item i[class^=fa]{margin-right:8px}.menu-item .badge{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-weight:700;line-height:1}.use-motion .menu-item{visibility:hidden}@media (width<=991px){.sidebar{left:-320px}.sidebar-active .sidebar{left:0}.sidebar{z-index:20;background:#222;width:320px;max-height:100vh;transition:left .2s ease-out,right .2s ease-out;position:fixed;top:0;bottom:0;overflow-y:auto;box-shadow:inset 0 2px 6px #000}.sidebar a{color:#999;border-bottom-color:#555}.sidebar a:hover{color:#eee;border-bottom-color:#eee}.links-of-author:not(:first-child){margin-top:15px}.links-of-author a{vertical-align:middle;border-bottom-color:#555;margin-bottom:10px;margin-right:10px;display:inline-block}.links-of-author a:before{content:" ";background:#051cab;border-radius:50%;width:4px;height:4px;margin-right:3px;display:inline-block;transform:translateY(-2px)}.links-of-blogroll-item{padding:0 5px}.popular-posts .popular-posts-item .popular-posts-link:hover{background:0 0}.sidebar-dimmer{opacity:0;visibility:hidden;z-index:10;background:#000;width:100%;height:100%;transition:visibility .4s,opacity .4s;position:fixed;top:0;left:0}.sidebar-active .sidebar-dimmer{opacity:.7;visibility:visible}}.sidebar-inner{color:#999;text-align:center;flex-direction:column;justify-content:center;padding:18px 10px;display:flex}.sidebar-toggle{cursor:pointer;opacity:.6;z-index:30;background:#222;width:16px;height:16px;padding:5px;position:fixed;bottom:61px;left:30px}@media (width<=991px){.sidebar-toggle{left:20px}}.sidebar-toggle:hover{opacity:.8}@media (width<=991px){.sidebar-toggle{opacity:.8}}.sidebar-toggle:hover .toggle-line{background:#fc6423}@media (any-hover:hover){body:not(.sidebar-active) .sidebar-toggle:hover :first-child{width:50%;top:2px;left:50%;transform:rotate(45deg)}body:not(.sidebar-active) .sidebar-toggle:hover :last-child{width:50%;top:-2px;left:50%;transform:rotate(-45deg)}}.sidebar-active .sidebar-toggle :nth-child(2){opacity:0}.sidebar-active .sidebar-toggle :first-child{top:6px;transform:rotate(45deg)}.sidebar-active .sidebar-toggle :last-child{top:-6px;transform:rotate(-45deg)}.sidebar-nav{pointer-events:none;visibility:hidden;height:0;margin:0;padding-left:0;font-size:.875em;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}.sidebar-nav-active .sidebar-nav{pointer-events:unset;height:calc(2em + 1px);visibility:unset}.sidebar-nav li{color:var(--text-color);cursor:pointer;border-bottom:1px solid #0000;transition:border-bottom-color .2s ease-in-out,color .2s ease-in-out;display:inline-block}.sidebar-nav li.sidebar-nav-overview{margin-left:10px}.sidebar-nav li:hover{color:#fc6423}.sidebar-toc-active .sidebar-nav-toc,.sidebar-overview-active .sidebar-nav-overview{color:#fc6423;border-bottom-color:#fc6423;transition-delay:.2s}.sidebar-toc-active .sidebar-nav-toc:hover,.sidebar-overview-active .sidebar-nav-overview:hover{color:#fc6423}.sidebar-panel-container{flex:1;align-items:start;padding-top:0;transition:padding-top .2s ease-in-out;display:grid;overflow:hidden auto}.sidebar-nav-active .sidebar-panel-container{padding-top:20px}.sidebar-panel{opacity:0;pointer-events:none;visibility:hidden;grid-area:1/1;height:0;transition:opacity .2s ease-in-out,transform .2s ease-in-out,visibility .2s ease-in-out;animation:.2s ease-in-out deactivate-sidebar-panel;overflow:hidden;transform:translateY(0)}.sidebar-nav-active .sidebar-panel,.sidebar-overview-active .sidebar-panel.post-toc-wrap{transform:translateY(-20px)}.sidebar-overview-active:not(.sidebar-nav-active) .sidebar-panel.post-toc-wrap{transition-delay:0s,.2s,0s}.sidebar-overview-active .sidebar-panel.site-overview-wrap,.sidebar-toc-active .sidebar-panel.post-toc-wrap{opacity:1;pointer-events:unset;height:auto;visibility:unset;transition-delay:.2s,.2s,0s;animation-name:activate-sidebar-panel;transform:translateY(0)}.sidebar-panel.site-overview-wrap{flex-direction:column;justify-content:flex-start;gap:10px;display:flex}@keyframes deactivate-sidebar-panel{0%{height:var(--inactive-panel-height,0)}to{height:var(--active-panel-height,0)}}@keyframes activate-sidebar-panel{0%{height:var(--inactive-panel-height,auto)}to{height:var(--active-panel-height,auto)}}.post-toc{font-size:.875em}.post-toc ol{text-align:left;margin:0;padding:0 2px 0 10px;list-style:none}.post-toc ol>:last-child{margin-bottom:5px}.post-toc ol>ol{padding-left:0}.post-toc ol a{transition:all .2s ease-in-out}.post-toc .nav-item{text-overflow:ellipsis;white-space:nowrap;line-height:1.8;overflow:hidden}.post-toc .nav .nav-child{--height:0;opacity:0;visibility:hidden;height:0;transition:all .2s ease-in-out;overflow:hidden}.post-toc .nav .active>.nav-child{height:var(--height,auto);opacity:1;visibility:unset}.post-toc .nav .active>a{color:#fc6423;border-bottom-color:#fc6423}.post-toc .nav .active-current>a,.post-toc .nav .active-current>a:hover{color:#fc6423}.site-author-image{border:1px solid #eee;max-width:120px;padding:2px}.site-author-name{color:var(--text-color);margin:0;font-weight:600}.site-description{color:#999;margin-top:0;font-size:.8125em}.site-state{flex-wrap:wrap;justify-content:center;line-height:1.4;display:flex}.site-state-item{padding:0 15px}.site-state-item a{border-bottom:0;display:block}.site-state-item-count{font-size:1em;font-weight:600;display:block}.site-state-item-name{color:#999;font-size:.8125em}.sidebar .sidebar-button:not(:first-child){margin-top:15px}.sidebar .sidebar-button button{color:#fc6423;cursor:pointer;background:0 0;border:1px solid #fc6423;border-radius:4px;padding:0 15px;line-height:2}.sidebar .sidebar-button button:hover{color:#fff;background:#fc6423}.sidebar .sidebar-button button i[class^=fa]{margin-right:5px}.links-of-author a{font-size:.8125em}.links-of-author i[class^=fa]{margin-right:2px}.cc-license .cc-opacity{opacity:.7;border-bottom:0}.cc-license .cc-opacity:hover{opacity:.9}.cc-license img{display:inline-block}.links-of-blogroll{font-size:.8125em}.links-of-blogroll-title{font-size:.875em;font-weight:600}.links-of-blogroll-list{flex-flow:column wrap;justify-content:center;gap:5px;margin:5px 0 0;padding:0;list-style:none;display:flex}.links-of-blogroll-item{max-width:100%}.links-of-blogroll-item a{box-sizing:border-box;text-overflow:ellipsis;white-space:nowrap;max-width:100%;display:inline-block;overflow:hidden}.footer{color:#999;padding:20px 0;font-size:.875em;transition:left .2s ease-in-out,right .2s ease-in-out}.footer.footer-fixed{position:absolute;bottom:0;left:0;right:0}.footer-inner{box-sizing:border-box;text-align:center;flex-direction:column;justify-content:center;width:calc(100% - 20px);margin:0 auto;display:flex}@media (width<=767px){.footer-inner{width:auto}}@media (width>=1200px){.footer-inner{width:1160px}}@media (width>=1600px){.footer-inner{width:73%}}.use-motion .footer{opacity:0}.languages{font-size:1.125em;display:inline-block;position:relative}.languages .lang-select-label span{margin:0 .5em}.languages .lang-select{opacity:0;width:100%;height:100%;position:absolute;top:0;left:0}.with-love{color: ;margin:0 5px;display:inline-block}@keyframes icon-animate{0%,to{transform:scale(1)}10%,30%{transform:scale(.9)}20%,40%,60%,80%{transform:scale(1.1)}50%,70%{transform:scale(1.1)}}.back-to-top{color:#fff;cursor:pointer;opacity:.6;z-index:30;background:#222;align-items:center;height:26px;font-size:12px;transition:bottom .2s ease-in-out;display:flex;position:fixed;bottom:-100px;left:30px}.back-to-top span{margin-right:8px}.back-to-top .fa{text-align:center;width:26px}@media (width<=991px){.back-to-top{left:20px}}.back-to-top:hover{opacity:.8}@media (width<=991px){.back-to-top{opacity:.8}}.back-to-top:hover{color:#fc6423}.back-to-top.back-to-top-on{bottom:30px}.reading-progress-bar{--progress:0;z-index:50;height:3px;width:var(--progress);background:#37c6c0;position:fixed;top:0;left:0}.rtl.post-body p,.rtl.post-body a,.rtl.post-body h1,.rtl.post-body h2,.rtl.post-body h3,.rtl.post-body h4,.rtl.post-body h5,.rtl.post-body h6,.rtl.post-body li,.rtl.post-body ul,.rtl.post-body ol{direction:rtl;font-family:UKIJ Ekran}.rtl.post-title{font-family:UKIJ Ekran}.post-button{text-align:center;margin-top:40px}.use-motion .post-block,.use-motion .pagination,.use-motion .comments,.use-motion .post-header,.use-motion .post-body,.use-motion .collection-header{visibility:hidden}.posts-collapse .post-content{margin-bottom:35px;margin-left:35px;position:relative}@media (width<=767px){.posts-collapse .post-content{margin-left:0;margin-right:0}}.posts-collapse .post-content .collection-title{font-size:1.125em;position:relative}.posts-collapse .post-content .collection-title:before{content:" ";background:#999;border:1px solid #fff;border-radius:50%;width:10px;height:10px;margin-top:-4px;margin-left:-6px;position:absolute;top:50%}.posts-collapse .post-content .collection-year{margin:60px 0;font-size:1.5em;font-weight:700;position:relative}.posts-collapse .post-content .collection-year .collection-year-count{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-size:.75em;font-weight:700;line-height:1}.posts-collapse .post-content .collection-year:before{content:" ";background:#bbb;border-radius:50%;width:8px;height:8px;margin-top:-4px;margin-left:-4px;position:absolute;top:50%}.posts-collapse .post-content .collection-header{margin-left:20px;display:block}.posts-collapse .post-content .collection-header small{color:#bbb;margin-left:5px}.posts-collapse .post-content .post-header{border-bottom:1px dashed #ccc;margin:30px 2px 0;padding-left:15px;transition:border .2s ease-in-out;position:relative}.posts-collapse .post-content .post-header:before{content:" ";background:#bbb;border:1px solid #fff;border-radius:50%;width:6px;height:6px;transition:background .2s ease-in-out;position:absolute;top:.75em;left:-6px}.posts-collapse .post-content .post-header:hover{border-bottom-color:#666}.posts-collapse .post-content .post-header:hover:before{background:#222}.posts-collapse .post-content .post-meta-container{margin-right:10px;font-size:.75em;display:inline}.posts-collapse .post-content .post-title{display:inline}.posts-collapse .post-content .post-title a{color:var(--link-color);border-bottom:0}.posts-collapse .post-content .post-title .fa{margin-left:5px;font-size:.875em}.posts-collapse .post-content:before{content:" ";background:#f5f5f5;width:4px;height:100%;margin-left:-2px;position:absolute;top:1.25em}.post-body{overflow-wrap:break-word;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif}@media (width>=1200px){.post-body{font-size:1.125em}}@media (width>=992px){.post-body{text-align:justify}}@media (width<=991px){.post-body{text-align:justify}}.post-body h1 .header-anchor,.post-body h2 .header-anchor,.post-body h3 .header-anchor,.post-body h4 .header-anchor,.post-body h5 .header-anchor,.post-body h6 .header-anchor,.post-body h1 .headerlink,.post-body h2 .headerlink,.post-body h3 .headerlink,.post-body h4 .headerlink,.post-body h5 .headerlink,.post-body h6 .headerlink{color:inherit;float:right;opacity:0;border-bottom-style:none;margin-left:10px;font-size:.875em}.post-body h1 .header-anchor:before,.post-body h2 .header-anchor:before,.post-body h3 .header-anchor:before,.post-body h4 .header-anchor:before,.post-body h5 .header-anchor:before,.post-body h6 .header-anchor:before,.post-body h1 .headerlink:before,.post-body h2 .headerlink:before,.post-body h3 .headerlink:before,.post-body h4 .headerlink:before,.post-body h5 .headerlink:before,.post-body h6 .headerlink:before{content:"";font-family:"Font Awesome 7 Free";font-weight:900}.post-body h1:hover .header-anchor,.post-body h2:hover .header-anchor,.post-body h3:hover .header-anchor,.post-body h4:hover .header-anchor,.post-body h5:hover .header-anchor,.post-body h6:hover .header-anchor,.post-body h1:hover .headerlink,.post-body h2:hover .headerlink,.post-body h3:hover .headerlink,.post-body h4:hover .headerlink,.post-body h5:hover .headerlink,.post-body h6:hover .headerlink{opacity:.5}.post-body h1:hover .header-anchor:hover,.post-body h2:hover .header-anchor:hover,.post-body h3:hover .header-anchor:hover,.post-body h4:hover .header-anchor:hover,.post-body h5:hover .header-anchor:hover,.post-body h6:hover .header-anchor:hover,.post-body h1:hover .headerlink:hover,.post-body h2:hover .headerlink:hover,.post-body h3:hover .headerlink:hover,.post-body h4:hover .headerlink:hover,.post-body h5:hover .headerlink:hover,.post-body h6:hover .headerlink:hover{opacity:1}.post-body .exturl .fa{margin-left:4px;font-size:.875em}.post-body figure:not(.highlight){margin:0 auto 20px}.post-body figure:not(.highlight) figcaption{color:#999;text-align:center;margin:-15px auto 15px;font-size:.875em;font-weight:700;line-height:1}.post-body iframe,.post-body img,.post-body video,.post-body embed{margin-bottom:20px}.post-body .video-container{width:100%;height:0;margin-bottom:20px;padding-top:75%;position:relative;overflow:hidden}.post-body .video-container iframe,.post-body .video-container object,.post-body .video-container embed{width:100%;height:100%;margin:0;position:absolute;top:0;left:0}.post-gallery{min-height:200px;display:flex}.post-gallery .post-gallery-image{flex:1}.post-gallery .post-gallery-image:not(:first-child){clip-path:polygon(40px 0,100% 0,100% 100%,0 100%);margin-left:-20px}.post-gallery .post-gallery-image:not(:last-child){margin-right:-20px}.post-gallery .post-gallery-image img{object-fit:cover;opacity:1;width:100%;height:100%}.posts-expand .post-gallery{margin-bottom:60px}.posts-collapse .post-gallery{margin:15px 0}.posts-expand .post-header{text-align:center;margin-bottom:60px;font-size:1.125em}.posts-expand .post-title{margin:initial;overflow-wrap:break-word;font-size:1.5em;font-weight:400}.posts-expand .post-title-link{color:var(--link-color);border-bottom:0;max-width:100%;display:inline-block;position:relative}.posts-expand .post-title-link:before{background:var(--link-color);content:"";width:100%;height:2px;transition:transform .2s ease-in-out;position:absolute;bottom:0;left:0;transform:scaleX(0)}.posts-expand .post-title-link:hover:before{transform:scaleX(1)}.posts-expand .post-title-link .fa{margin-left:5px;font-size:.875em}.post-sticky-flag{margin-right:8px;display:inline-block;transform:rotate(30deg)}.posts-expand .post-meta-container{color:#999;margin-top:3px;font-family:Lato,PingFang SC,Microsoft YaHei,sans-serif;font-size:.75em}.posts-expand .post-meta-container .post-description{margin-top:2px;font-size:.875em}.posts-expand .post-meta-container time{border-bottom:1px dashed #999}.post-meta{flex-wrap:wrap;justify-content:center;display:flex}:not(.post-meta-break)+.post-meta-item:before{content:"|";margin:0 .5em}.post-meta-item-icon{margin-right:3px}@media (width<=991px){.post-meta-item-text{display:none}}.post-meta-break{flex-basis:100%;height:0}.post-nav{border-top:1px solid #eee;justify-content:space-between;gap:30px;margin-top:1em;padding:10px 5px 0;display:flex}.post-nav-item{flex:1}.post-nav-item a{border-bottom:0;font-size:.875em;line-height:1.6;display:block}.post-nav-item a:active{top:2px}.post-nav-item .fa{font-size:.75em}.post-nav-item:first-child .fa{margin-right:5px}.post-nav-item:last-child{text-align:right}.post-nav-item:last-child .fa{margin-left:5px}.post-footer{flex-direction:column;justify-content:center;display:flex}.post-eof{background:#ccc;width:8%;height:1px;margin:80px auto 60px}.post-block:last-of-type .post-eof{display:none}.post-copyright ul{background:var(--card-bg-color);border-left:3px solid #ff2a2a;margin:1em 0 0;padding:.5em 1em;list-style:none;position:relative;overflow:hidden}.post-copyright ul:after{content:"";opacity:.1;font-family:"Font Awesome 7 Brands";font-size:200px;position:absolute;top:-150px;right:-50px}.post-tags{text-align:center;margin-top:40px}.post-tags a{font-size:.8125em;display:inline-block}.post-tags a:not(:last-child){margin-right:10px}.social-like{border-top:1px solid #eee;flex-wrap:wrap;justify-content:center;margin-top:1em;padding-top:1em;font-size:.875em;display:flex}.social-like a{border-bottom:none}.reward-container{text-align:center;margin:1em 0 0;padding:1em 0}.reward-container button{color:#fc6423;cursor:pointer;vertical-align:text-top;background:0 0;border:2px solid #fc6423;border-radius:2px;outline:0;padding:0 15px;line-height:2}.reward-container button:hover{color:#fff;background:#fc6423}.post-reward{padding-top:20px;display:none}.post-reward.active{display:block}.post-reward div{display:inline-block}.post-reward div span{display:block}.post-reward img{width:180px;max-width:100%;margin:.8em 2em 0;display:inline-block}@keyframes next-roll{0%{transform:rotate(30deg)}to{transform:rotate(-30deg)}}.category-all-page .category-all-title{text-align:center}.category-all-page .category-all{margin-top:20px}.category-all-page .category-list{margin:0;padding:0;list-style:none}.category-all-page .category-list-item{margin:5px 10px}.category-all-page .category-list-count{color:var(--content-bg-color);text-shadow:1px 1px #0000001a;background:#ccc;border-radius:10px;margin-left:.35em;padding:2px 5px;font-size:.75em;font-weight:700;line-height:1}.category-all-page .category-list-child{padding-left:10px}.event-list hr{background:#222;margin:20px 0 45px}.event-list hr:after{color:#fff;content:"NOW";background:#222;padding:0 5px;font-weight:700;display:inline-block}.event-list .event{--event-background:#222;--event-foreground:#bbb;--event-title:#fff;background:var(--event-background);padding:15px}.event-list .event .event-summary{color:var(--event-title);border-bottom:0;margin:0;padding:0 0 0 35px;position:relative}.event-list .event .event-summary:before{background:var(--event-title);content:" ";border-radius:50%;width:12px;height:12px;margin-top:-6px;animation:1s ease-in-out infinite alternate dot-flash;position:absolute;top:50%;left:0}.event-list .event:nth-of-type(odd) .event-summary:before{animation-delay:.5s}.event-list .event:not(:last-child){margin-bottom:20px}.event-list .event .event-relative-time{color:var(--event-foreground);padding-left:12px;font-size:12px;font-weight:400;display:inline-block}.event-list .event .event-details{color:var(--event-foreground);padding:6px 0 6px 35px;line-height:18px;display:block}.event-list .event .event-details:before{color:var(--event-foreground);width:14px;margin-right:9px;font-family:"Font Awesome 7 Free";font-weight:900;display:inline-block}.event-list .event .event-details.event-location:before{content:""}.event-list .event .event-details.event-duration:before{content:""}.event-list .event .event-details.event-description:before{content:""}.event-list .event-past{--event-background:#f5f5f5;--event-foreground:#999;--event-title:#222}@keyframes dot-flash{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}ul.breadcrumb{text-align:center;margin:1em 0;padding:0 2em;font-size:.75em;list-style:none}ul.breadcrumb li{display:inline}ul.breadcrumb li:not(:first-child):before{content:"/ ";padding:.5em;font-weight:400}ul.breadcrumb li:last-child{font-weight:700}.tag-cloud{text-align:center}.tag-cloud a{margin:10px;display:inline-block}.tag-cloud-0{color:#aaa;border-bottom-color:#aaa}.tag-cloud-1{color:#9a9a9a;border-bottom-color:#9a9a9a}.tag-cloud-2{color:#8b8b8b;border-bottom-color:#8b8b8b}.tag-cloud-3{color:#7c7c7c;border-bottom-color:#7c7c7c}.tag-cloud-4{color:#6c6c6c;border-bottom-color:#6c6c6c}.tag-cloud-5{color:#5d5d5d;border-bottom-color:#5d5d5d}.tag-cloud-6{color:#4e4e4e;border-bottom-color:#4e4e4e}.tag-cloud-7{color:#3e3e3e;border-bottom-color:#3e3e3e}.tag-cloud-8{color:#2f2f2f;border-bottom-color:#2f2f2f}.tag-cloud-9{color:#202020;border-bottom-color:#202020}.tag-cloud-10{color:#111;border-bottom-color:#111}.search-active{margin-right:var(--dialog-scrollgutter,0);overflow:hidden}.search-pop-overlay{visibility:hidden;z-index:40;background:0 0;width:100%;height:100%;transition:visibility .4s,background .4s;display:flex;position:fixed;top:0;left:0}.search-active .search-pop-overlay{visibility:visible;background:#0000004d}.search-popup{background:var(--card-bg-color);border-radius:5px;width:700px;height:80%;margin:auto;transition:transform .4s;transform:scale(0)}.search-active .search-popup{transform:scale(1)}@media (width<=767px){.search-popup{border-radius:0;width:100%;height:100%}}.search-popup .search-icon,.search-popup .popup-btn-close{color:#999;padding:0 10px;font-size:18px}.search-popup .popup-btn-close{cursor:pointer}.search-popup .popup-btn-close:hover .fa{color:#222}.search-popup .search-header{background:#eee;border-top-left-radius:5px;border-top-right-radius:5px;padding:5px;display:flex}.search-popup input.search-input{background:0 0;border:0;outline:0;width:100%}.search-popup input.search-input::-webkit-search-cancel-button{display:none}.search-popup .search-result-container{flex-direction:column;height:calc(100% - 55px);padding:5px 25px;display:flex;overflow:auto}.search-popup .search-result-container hr{flex-shrink:0;margin:5px 0 10px}.search-popup .search-result-container hr:first-child{display:none}.search-popup .search-result-list{margin:0 5px;padding:0}.search-popup a.search-result-title{font-weight:700}.search-popup p.search-result{border-bottom:1px dashed #ccc;margin:0 0 10px;padding:5px 0}.search-popup .search-input-container{flex-grow:1;padding:2px}.search-popup .search-result-icon{color:#ccc;margin:auto}mark.search-keyword{color:#ff2a2a;background:0 0;border-bottom:1px dashed #ff2a2a;font-weight:700}mjx-container[jax=CHTML][display=true],.has-jax{overflow:auto hidden}mjx-container[display=true]+br{display:none}.use-motion .animated{visibility:inherit;animation-fill-mode:none}.use-motion .sidebar .animated{animation-fill-mode:both}header.header{background:var(--content-bg-color);border-radius:initial;box-shadow:initial}@media (width<=991px){header.header{border-radius:initial}}.main{justify-content:space-between;align-items:stretch;width:calc(100% - 20px);margin:0 auto;display:flex}@media (width<=767px){.main{width:auto}}@media (width>=1200px){.main{width:1160px}}@media (width>=1600px){.main{width:73%}}@media (width<=991px){.main{width:auto;display:block}}.main-inner{border-radius:initial;box-sizing:border-box;width:calc(100% - 252px)}@media (width<=991px){.main-inner{border-radius:initial;width:100%}}.footer-inner{padding-left:252px}@media (width<=991px){.footer-inner{width:auto;padding-left:0;padding-right:0}}.column{width:240px}@media (width<=991px){.column{width:auto}}.site-brand-container{background:var(--theme-color)}@media (width<=991px){.site-nav-on .site-brand-container{box-shadow:0 0 16px #00000080}}.site-meta{padding:20px 0}@media (width>=768px) and (width<=991px){.site-nav-toggle,.site-nav-right{flex-direction:column;justify-content:center;display:flex}}.site-nav-toggle .toggle,.site-nav-right .toggle{color:#fff}.site-nav-toggle .toggle .toggle-line,.site-nav-right .toggle .toggle-line{background:#fff}@media (width>=768px) and (width<=991px){.site-nav{--scroll-height:0;visibility:hidden;height:0;transition:height .2s ease-in-out,visibility .2s ease-in-out;overflow:hidden}body:not(.site-nav-on) .site-nav .animated{animation:none}body.site-nav-on .site-nav{height:var(--scroll-height);visibility:unset}}.menu .menu-item{margin:0;display:block}.menu .menu-item a{align-items:center;padding:5px 20px;transition-property:background-color;display:flex;position:relative}.menu .menu-item a .badge{margin-left:auto}@media (width<=991px){.menu .menu-item.menu-item-search{display:none}}.main-menu .menu-item-active:after{content:" ";background:#bbb;border-radius:50%;width:6px;height:6px;margin-top:-3px;position:absolute;top:50%;right:15px}.sub-menu{margin:0;padding:6px 0}.sub-menu .menu-item{display:inline-block}.sub-menu .menu-item a{padding:initial;background:0 0;margin:5px 10px}.sub-menu .menu-item a:hover{color:#fc6423;background:0 0}.sub-menu .menu-item-active{color:#fc6423;border-bottom-color:#fc6423}.sub-menu .menu-item-active:hover{border-bottom-color:#fc6423}@media (width>=992px){.sidebar{position:sticky;top:12px}.sidebar-toggle{display:none}.sidebar-inner{background:var(--content-bg-color);border-radius:initial;box-shadow:initial;box-sizing:border-box;color:var(--text-color);visibility:hidden;max-height:calc(100vh - 24px);margin-top:12px}.site-state-item{padding:0 10px}.sidebar .sidebar-button{border-top:1px dotted #ccc;border-bottom:1px dotted #ccc}.sidebar .sidebar-button button{color:#fc6423;border:0;width:100%;display:block}.sidebar .sidebar-button button:hover{color:#e34603;background:0 0;border:0}.links-of-author{flex-wrap:wrap;justify-content:center;display:flex}.links-of-author-item{width:50%;margin:5px 0 0}.links-of-author-item a{box-sizing:border-box;text-overflow:ellipsis;white-space:nowrap;border-bottom:0;border-radius:4px;max-width:100%;padding:0 5px;display:inline-block;overflow:hidden}.links-of-author-item a:hover{background:var(--body-bg-color)}.links-of-blogroll-item a{padding:0 5px}}.main-inner{background:var(--content-bg-color);box-shadow:initial;padding:40px}@media (width<=991px){.main-inner{padding:20px}}.sub-menu{border-bottom:1px solid #ddd}.post-block:first-of-type{padding-top:40px}@media (width<=767px){.pagination{margin-bottom:10px}}</style><link integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css rel=stylesheet><link integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css rel=stylesheet><link integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin href=https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css rel=stylesheet><script class=next-config data-name=main type=application/json>{"hostname":"wulc.me","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.25.0","exturl":true,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500}},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script defer src=/js/config.js></script><meta content="本文是 Effective Go 中的一些摘记，主要涉及 golang 中的语法、技巧、风格等。为了尽可能保持原文意思，会通过英文记录相关的知识点。" name=description><meta content=article property=og:type><meta content="Effective Go 摘记" property=og:title><meta content=https://wulc.me/2019/02/18/Effective%20Go%20%E6%91%98%E8%AE%B0/index.html property=og:url><meta content=吴良超的学习笔记 property=og:site_name><meta content="本文是 Effective Go 中的一些摘记，主要涉及 golang 中的语法、技巧、风格等。为了尽可能保持原文意思，会通过英文记录相关的知识点。" property=og:description><meta content=zh_CN property=og:locale><meta content=2019-02-18T14:31:17.000Z property=article:published_time><meta content=2026-02-06T11:50:23.746Z property=article:modified_time><meta content=良超 property=article:author><meta content=go property=article:tag><meta content=summary name=twitter:card><link href=https://wulc.me/2019/02/18/Effective%20Go%20%E6%91%98%E8%AE%B0/ rel=canonical><script class=next-config data-name=page type=application/json>{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://wulc.me/2019/02/18/Effective%20Go%20%E6%91%98%E8%AE%B0/","path":"2019/02/18/Effective Go 摘记/","title":"Effective Go 摘记"}</script><script class=next-config data-name=calendar type=application/json>""</script><title>Effective Go 摘记 | 吴良超的学习笔记</title><script integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js></script><script integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js></script><script integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js></script><script integrity="sha256-JnmRRnJK7DC6RQJbAJb6AXOM9OmWzS6z8eYultk/48Y=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/pangu/7.2.0/pangu.umd.js></script><script defer src=/js/utils.js></script><script defer src=/js/motion.js></script><script defer src=/js/sidebar.js></script><script defer src=/js/next-boot.js></script><script integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin defer src=https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js></script><script defer src=/js/third-party/search/local-search.js></script><script defer src=/js/third-party/fancybox.js></script><script class=next-config data-name=enableMath type=application/json>true</script><script class=next-config data-name=mathjax type=application/json>{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script defer src=/js/third-party/math/mathjax.js></script><noscript><link href=/css/noscript.css rel=stylesheet></noscript><link href=/atom.xml rel=alternate title=吴良超的学习笔记 type=application/atom+xml><body class=use-motion itemscope itemtype=http://schema.org/WebPage><div class=headband></div><main class=main><div class=column><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=site-brand-container><div class=site-nav-toggle><div aria-label=切换导航栏 class=toggle role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div></div><div class=site-meta><a class=brand href=/ rel=start> <i class=logo-line></i> <p class=site-title>吴良超的学习笔记</p> <i class=logo-line></i> </a></div><div class=site-nav-right><div class="toggle popup-trigger" aria-label=搜索 role=button><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ rel=section><i class="fa fa-home fa-fw"></i>首页</a><li class="menu-item menu-item-tags"><a href=/tags/ rel=section><i class="fa fa-tags fa-fw"></i>标签</a><li class="menu-item menu-item-archives"><a href=/archives/ rel=section><i class="fa fa-archive fa-fw"></i>归档</a><li class="menu-item menu-item-search"><a class=popup-trigger role=button><i class="fa fa-search fa-fw"></i>搜索 </a></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon> <i class="fa fa-search"></i> </span><div class=search-input-container><input autocapitalize=off autocomplete=off class=search-input maxlength=80 placeholder=搜索... spellcheck=false type=search></div><span class=popup-btn-close role=button> <i class="fa fa-times-circle"></i> </span></div><div class=search-result-container><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录<li class=sidebar-nav-overview>站点概览</ul><div class=sidebar-panel-container><!--noindex--><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class=nav><li class="nav-item nav-level-2"><a class=nav-link href=#formatting><span class=nav-number>1.</span> <span class=nav-text>Formatting</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#commentary><span class=nav-number>2.</span> <span class=nav-text>Commentary</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#names><span class=nav-number>3.</span> <span class=nav-text>Names</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#control-structures><span class=nav-number>4.</span> <span class=nav-text>Control structures</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#functions><span class=nav-number>5.</span> <span class=nav-text>Functions</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#data><span class=nav-number>6.</span> <span class=nav-text>Data</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#new-v.s-make><span class=nav-number>6.1.</span> <span class=nav-text>new v.s make</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#array-v.s-slice><span class=nav-number>6.2.</span> <span class=nav-text>array v.s slice</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#map><span class=nav-number>6.3.</span> <span class=nav-text>map</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#methods><span class=nav-number>7.</span> <span class=nav-text>Methods</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#interfaces-and-other-types><span class=nav-number>8.</span> <span class=nav-text>Interfaces and other types</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#interfaces><span class=nav-number>8.1.</span> <span class=nav-text>Interfaces</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#concurrency><span class=nav-number>9.</span> <span class=nav-text>Concurrency</span></a><ol class=nav-child><li class="nav-item nav-level-3"><a class=nav-link href=#share-by-communicating><span class=nav-number>9.1.</span> <span class=nav-text>Share by communicating</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#goroutines><span class=nav-number>9.2.</span> <span class=nav-text>Goroutines</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#channels><span class=nav-number>9.3.</span> <span class=nav-text>Channels</span></a><li class="nav-item nav-level-3"><a class=nav-link href=#channels-of-channels><span class=nav-number>9.4.</span> <span class=nav-text>Channels of channels</span></a></ol><li class="nav-item nav-level-2"><a class=nav-link href=#errors><span class=nav-number>10.</span> <span class=nav-text>Errors</span></a><li class="nav-item nav-level-2"><a class=nav-link href=#some-syntax><span class=nav-number>11.</span> <span class=nav-text>Some Syntax</span></a></ol></div></div><!--/noindex--><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop=author itemscope itemtype=http://schema.org/Person><img alt=良超 class=site-author-image itemprop=image src=/files/profile.jpg><p class=site-author-name itemprop=name>良超<div class=site-description itemprop=description>盈亏同源，拥抱随机性</div></div><div class="site-state-wrap animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/> <span class=site-state-item-count>269</span> <span class=site-state-item-name>日志</span> </a></div><div class="site-state-item site-state-categories"><span class=site-state-item-count>33</span><span class=site-state-item-name>分类</span></div><div class="site-state-item site-state-tags"><a href=/tags/> <span class=site-state-item-count>51</span> <span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-author animated"><span class=links-of-author-item> <span data-url="aHR0cHM6Ly9naXRodWIuY29tL1d1TEM=" title="GitHub → https://github.com/WuLC" class=exturl><i class="fab fa-github fa-fw"></i>GitHub</span> </span><span class=links-of-author-item> <span data-url="bWFpbHRvOmxpYW5nY2hhb3d1NUBnbWFpbC5jb20=" title="E-Mail → mailto:liangchaowu5@gmail.com" class=exturl><i class="fa fa-envelope fa-fw"></i>E-Mail</span> </span><span class=links-of-author-item> <a rel="noopener me" title="RSS → /atom.xml" href=/atom.xml><i class="fa fa-rss fa-fw"></i>RSS</a> </span></div><div class="cc-license animated" itemprop=license><span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img alt="Creative Commons" src=https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg></span></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class=post-block><article class=post-content itemscope itemtype=http://schema.org/Article lang=zh-CN><link href=https://wulc.me/2019/02/18/Effective%20Go%20%E6%91%98%E8%AE%B0/ itemprop=mainEntityOfPage><span hidden itemprop=author itemscope itemtype=http://schema.org/Person> <meta content=/files/profile.jpg itemprop=image> <meta content=良超 itemprop=name> </span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization> <meta content=吴良超的学习笔记 itemprop=name> <meta content=盈亏同源，拥抱随机性 itemprop=description> </span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork> <meta content="Effective Go 摘记 | 吴良超的学习笔记" itemprop=name> <meta itemprop=description> </span><header class=post-header><h1 itemprop="name headline" class=post-title>Effective Go 摘记</h1><div class=post-meta-container><div class=post-meta><span class=post-meta-item> <span class=post-meta-item-icon> <i class="far fa-calendar"></i> </span> <span class=post-meta-item-text>发表于</span> <time itemprop="dateCreated datePublished" title="创建时间：2019-02-18 22:31:17" datetime=2019-02-18T22:31:17+08:00>2019-02-18</time> </span><span class=post-meta-item> <span class=post-meta-item-icon> <i class="fa fa-tags"></i> </span> <span class=post-meta-item-text>标签</span> <span itemprop=about itemscope itemtype=http://schema.org/Thing> <a href=/tags/go/ itemprop=url rel=index><span itemprop=name>go</span></a> </span> </span></div></div></header><div class=post-body itemprop=articleBody><p>本文是 <span data-url="aHR0cHM6Ly9nb2xhbmcub3JnL2RvYy9lZmZlY3RpdmVfZ28uaHRtbA==" class=exturl>Effective Go<i class="fa fa-external-link-alt"></i></span> 中的一些摘记，主要涉及 golang 中的语法、技巧、风格等。为了尽可能保持原文意思，会通过英文记录相关的知识点。</p><span id=more></span><h2 id=formatting>Formatting</h2><ul><li>The gofmt program (also available as <code>go fmt</code>, which operates at the package level rather than source file level) reads a Go program and emits the source in a standard style of indentation and vertical alignment, retaining and if necessary reformatting comments.</ul><h2 id=commentary>Commentary</h2><ul><li><p><strong>Every package should have a package comment, a block comment preceding the package clause.</strong> For multi-file packages, the package comment only needs to be present in one file, and any one will do. The package comment should introduce the package and provide information relevant to the package as a whole, for example<figure class="highlight go"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=comment>/*</span></span><br><span class=line><span class=comment>Package regexp implements a simple library for regular expressions.</span></span><br><span class=line><span class=comment></span></span><br><span class=line><span class=comment>The syntax of the regular expressions accepted is:</span></span><br><span class=line><span class=comment>    .......</span></span><br><span class=line><span class=comment>*/</span></span><br><span class=line><span class=keyword>package</span> regexp</span><br></pre></table></figure><p><li><p>Doc comments work best as complete sentences, which allow a wide variety of automated presentations. <strong>The first sentence should be a one-sentence summary that starts with the name being declared</strong>.<figure class="highlight go"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=comment>// Compile parses a regular expression and returns, if successful,</span></span><br><span class=line><span class=comment>// a Regexp that can be used to match against text.</span></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>Compile</span><span class=params>(str <span class=type>string</span>)</span></span> (*Regexp, <span class=type>error</span>) {</span><br></pre></table></figure><p><li><p><strong>Grouping variables</strong> can indicate relationships between items, such as the fact that a set of variables is protected by a mutex.<figure class="highlight go"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br></pre><td class=code><pre><span class=line><span class=keyword>var</span> (</span><br><span class=line>    countLock   sync.Mutex</span><br><span class=line>    inputCount  <span class=type>uint32</span></span><br><span class=line>    outputCount <span class=type>uint32</span></span><br><span class=line>    errorCount  <span class=type>uint32</span></span><br><span class=line>)</span><br></pre></table></figure><p></ul><h2 id=names>Names</h2><ul><li><p>By convention, <strong>packages are given lower case, single-word names, no need for underscores or mixedCaps</strong><li><p>Another convention is that <strong>the package name is the base name of its source directory</strong>; the package in "src/encoding/base64" is imported as "encoding/base64" but has name base64, not encoding_base64 and not encodingBase64<li><p>By convention, <strong>one-method interfaces are named by the method name plus an -er suffix</strong> or similar modification to construct an agent noun: Reader, Writer, Formatter, CloseNotifier<li><p>the convention in Go is to <strong>use <code>MixedCaps</code> or <code>mixedCaps</code> rather than underscores to write multiword names</strong></ul><h2 id=control-structures>Control structures</h2><ul><li><p><code>if</code> and <code>switch</code> accept an <strong>optional initialization statement</strong> like that of <code>for</code><figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre><td class=code><pre><span class=line><span class=keyword>if</span> err := file.Chmod(<span class=number>0664</span>); err != <span class=literal>nil</span> {</span><br><span class=line>    log.Print(err)</span><br><span class=line>    <span class=keyword>return</span> err</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>In a <code>:=</code> declaration a variable v may appear even if it has already been declared, providing that <strong>there is at least one other variable in the declaration that is being declared anew</strong>, otherwise an error <code>no new variables on left side of :=</code> will occur<figure class="highlight go"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=comment>// legal for err</span></span><br><span class=line>f, err := os.Open(name)</span><br><span class=line>d, err := f.Stat()</span><br><span class=line></span><br><span class=line><span class=comment>// not legal for a</span></span><br><span class=line>a := <span class=number>1</span></span><br><span class=line>a := <span class=number>2</span></span><br><span class=line></span><br><span class=line><span class=comment>// not legal for a and b</span></span><br><span class=line>a, b := <span class=number>1</span>, <span class=number>1</span></span><br><span class=line>a, b := <span class=number>2</span>, <span class=number>2</span></span><br></pre></table></figure><p><li><p><strong>For strings, the <code>range</code> breaks out individual Unicode code points</strong> by parsing the UTF-8. Erroneous encodings consume one byte and produce the replacement rune U+FFFD, <strong>rune is Go terminology for a single Unicode code point</strong>, similar to char in other languages<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=keyword>for</span> pos, char := <span class=keyword>range</span> <span class=string>"日本\x80語"</span> { <span class=comment>// \x80 is an illegal UTF-8 encoding</span></span><br><span class=line>    fmt.Printf(<span class=string>"character %#U starts at byte position %d\n"</span>, char, pos)</span><br><span class=line>}</span><br><span class=line><span class=comment>/* output</span></span><br><span class=line><span class=comment>character U+65E5 '日' starts at byte position 0</span></span><br><span class=line><span class=comment>character U+672C '本' starts at byte position 3</span></span><br><span class=line><span class=comment>character U+FFFD '�' starts at byte position 6</span></span><br><span class=line><span class=comment>character U+8A9E '語' starts at byte position 7</span></span><br><span class=line><span class=comment>*/</span></span><br></pre></table></figure><p><li><p>if the <code>switch</code>has no expression it switches on true. It's therefore possible—and idiomatic—to <strong>write an if-else-if-else chain as a switch</strong>.<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>unhex</span><span class=params>(c <span class=type>byte</span>)</span></span> <span class=type>byte</span> {</span><br><span class=line>    <span class=keyword>switch</span> {</span><br><span class=line>    <span class=keyword>case</span> <span class=string>'0'</span> &lt;= c && c &lt;= <span class=string>'9'</span>:</span><br><span class=line>        <span class=keyword>return</span> c - <span class=string>'0'</span></span><br><span class=line>    <span class=keyword>case</span> <span class=string>'a'</span> &lt;= c && c &lt;= <span class=string>'f'</span>:</span><br><span class=line>        <span class=keyword>return</span> c - <span class=string>'a'</span> + <span class=number>10</span></span><br><span class=line>    <span class=keyword>case</span> <span class=string>'A'</span> &lt;= c && c &lt;= <span class=string>'F'</span>:</span><br><span class=line>        <span class=keyword>return</span> c - <span class=string>'A'</span> + <span class=number>10</span></span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>return</span> <span class=number>0</span></span><br><span class=line>}</span><br></pre></table></figure><p></ul><h2 id=functions>Functions</h2><ul><li><p>Deferred functions are executed in <strong>LIFO order(imagine it like a stack)</strong>, so the following code will cause 4 3 2 1 0 to be printed when the function returns.<figure class="highlight go"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>for</span> i := <span class=number>0</span>; i &lt; <span class=number>5</span>; i++ {</span><br><span class=line>    <span class=keyword>defer</span> fmt.Printf(<span class=string>"%d "</span>, i)</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>The <strong>arguments to deferred functions are evaluated when the defer executes</strong>, not when the function executes<figure class="highlight go"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br><span class=line>31</span><br><span class=line>32</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>trace</span><span class=params>(s <span class=type>string</span>)</span></span> <span class=type>string</span> {</span><br><span class=line>    fmt.Println(<span class=string>"entering:"</span>, s)</span><br><span class=line>    <span class=keyword>return</span> s</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>un</span><span class=params>(s <span class=type>string</span>)</span></span> {</span><br><span class=line>    fmt.Println(<span class=string>"leaving:"</span>, s)</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>a</span><span class=params>()</span></span> {</span><br><span class=line>    <span class=keyword>defer</span> un(trace(<span class=string>"a"</span>))</span><br><span class=line>    fmt.Println(<span class=string>"in a"</span>)</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>b</span><span class=params>()</span></span> {</span><br><span class=line>    <span class=keyword>defer</span> un(trace(<span class=string>"b"</span>))</span><br><span class=line>    fmt.Println(<span class=string>"in b"</span>)</span><br><span class=line>    a()</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>main</span><span class=params>()</span></span> {</span><br><span class=line>    b()</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>/*output</span></span><br><span class=line><span class=comment>entering: b</span></span><br><span class=line><span class=comment>in b</span></span><br><span class=line><span class=comment>entering: a</span></span><br><span class=line><span class=comment>in a</span></span><br><span class=line><span class=comment>leaving: a</span></span><br><span class=line><span class=comment>leaving: b</span></span><br><span class=line><span class=comment>*/</span></span><br></pre></table></figure><p></ul><h2 id=data>Data</h2><h3 id=new-v.s-make>new v.s make</h3><ul><li><p>Go has two allocation primitives, the built-in functions <strong><code>new</code> and <code>make</code></strong><li><p><code>New</code> does not initialize the memory, <strong><code>new(T)</code> allocates zeroed storage for a new item of type T and returns its address,</strong> that is a pointer to a newly allocated zero value of type T, it's helpful to arrange when designing your data structures that the zero value of each type can be used without further initialization<li><p>Sometimes <strong>the zero value isn't good enough and an initializing constructor is necessary</strong>, as in this example derived from package os<figure class="highlight go"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>NewFile</span><span class=params>(fd <span class=type>int</span>, name <span class=type>string</span>)</span></span> *File {</span><br><span class=line>    <span class=keyword>if</span> fd &lt; <span class=number>0</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>nil</span></span><br><span class=line>    }</span><br><span class=line>    f := <span class=built_in>new</span>(File)</span><br><span class=line>    f.fd = fd</span><br><span class=line>    f.name = name</span><br><span class=line>    f.dirinfo = <span class=literal>nil</span></span><br><span class=line>    f.nepipe = <span class=number>0</span></span><br><span class=line>    <span class=keyword>return</span> f</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>We can simplify it using a <strong>composite literal</strong>, which is an expression that creates a new instance each time it is evaluated(<code>File{fd, name, nil, 0}</code> in the following code). If a composite literal contains no fields at all, it creates a zero value for the type. <strong>The expressions <code>new(File)</code> and <code>&File{}</code> are equivalent</strong>.<figure class="highlight go"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>NewFile</span><span class=params>(fd <span class=type>int</span>, name <span class=type>string</span>)</span></span> *File {</span><br><span class=line>    <span class=keyword>if</span> fd &lt; <span class=number>0</span> {</span><br><span class=line>        <span class=keyword>return</span> <span class=literal>nil</span></span><br><span class=line>    }</span><br><span class=line>    f := File{fd, name, <span class=literal>nil</span>, <span class=number>0</span>}</span><br><span class=line>    <span class=keyword>return</span> &f</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>Note that <strong>unlike in C, it's perfectly OK to return the address of a local variable</strong>, the storage associated with the variable survives after the function returns<li><p><code>make(T, args)</code> serves a purpose different from new(T), it **creates slices, maps, and channels only, and it returns an initialized (not zeroed) value of type T (not *T)**<li><p>The reason for the distinction is that these three types(slices, maps, and channels) represent, under the covers, references to <strong>data structures that must be initialized before use</strong></ul><h3 id=array-v.s-slice>array v.s slice</h3><ul><li><p>There are major differences between the ways arrays work in Go and C. In Go,</p> <ul><li>Arrays are values. <strong>Assigning one array to another copies all the elements</strong>.<li>In particular, if you <strong>pass an array to a function, it will receive a copy of the array, not a pointer to it</strong>.<li>The size of an array is part of its type. <strong>The types [10]int and [20]int are distinct</strong></ul><li><p>The value property can be useful but also expensive; <strong>if you want C-like behavior and efficiency, you can pass a pointer to the array</strong><li><p>A slice does not store any data, it just describes a section of an underlying array, so <strong>if you assign one slice to another, both refer to the same array</strong><figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br></pre><td class=code><pre><span class=line>names := [<span class=number>4</span>]<span class=type>string</span>{</span><br><span class=line>	<span class=string>"John"</span>,</span><br><span class=line>	<span class=string>"Paul"</span>,</span><br><span class=line>	<span class=string>"George"</span>,</span><br><span class=line>	<span class=string>"Ringo"</span>,</span><br><span class=line>}</span><br><span class=line></span><br><span class=line>a := names[<span class=number>0</span>:<span class=number>2</span>]</span><br><span class=line>b := names[<span class=number>1</span>:<span class=number>3</span>]</span><br><span class=line></span><br><span class=line>b[<span class=number>0</span>] = <span class=string>"XXX"</span></span><br><span class=line>fmt.Println(a, b)</span><br><span class=line>fmt.Println(names)</span><br><span class=line><span class=comment>// output</span></span><br><span class=line><span class=comment>// [John XXX] [XXX George]</span></span><br><span class=line><span class=comment>// [John XXX George Ringo]</span></span><br></pre></table></figure><p><li><p>If a function takes a slice argument, <strong>modification of elements of the slice will be visible to the caller, but append elements won't</strong>, if you want to append elements to slice in function, pass the address instead<li><p>slices are variable-length, for a two-dimensional slice, it is possible to <strong>have each inner slice be a different length</strong><figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line>text := LinesOfText{</span><br><span class=line>	[]<span class=type>byte</span>(<span class=string>"Now is the time"</span>),</span><br><span class=line>	[]<span class=type>byte</span>(<span class=string>"for all good gophers"</span>),</span><br><span class=line>	[]<span class=type>byte</span>(<span class=string>"to bring some fun to the party."</span>),</span><br><span class=line>}</span><br></pre></table></figure><p></ul><h3 id=map>map</h3><ul><li><p>For a map in golang like <code>map[KeyType]ValueType</code>, <strong>KeyType may be any type that is <span class=exturl data-url=aHR0cHM6Ly9nb2xhbmcub3JnL3JlZi9zcGVjI0NvbXBhcmlzb25fb3BlcmF0b3Jz>comparable<i class="fa fa-external-link-alt"></i></span></strong> ,such as integers, floating point and complex numbers, strings, pointers, interfaces (as long as the dynamic type supports equality).Slices cannot be used as map keys, because equality is not defined on them, and <strong>ValueType may be any type at all, including another map!</strong><figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>hits := <span class=built_in>make</span>(<span class=keyword>map</span>[<span class=type>string</span>]<span class=keyword>map</span>[<span class=type>string</span>]<span class=type>int</span>)</span><br><span class=line>n := hits[<span class=string>"/doc/"</span>][<span class=string>"au"</span>]</span><br></pre></table></figure><p><li><p>Like slices, maps hold references to an underlying data structure. <strong>If you pass a map to a function that changes the contents of the map, the changes will be visible in the caller.</strong><li><p>An attempt to fetch a map value with <strong>a key that is not present in the map will return the zero value for the type of the entries in the map</strong>.The zero value is:</p> <ul><li>0 for numeric types,<li>false for the boolean type<li>"" (the empty string) for strings.</ul><li><p>If you need to judge whether a key in map, you can do this<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line><span class=keyword>if</span> val, ok := dict[<span class=string>"foo"</span>]; ok {</span><br><span class=line>    <span class=comment>//do something here</span></span><br><span class=line>}</span><br></pre></table></figure><p></ul><h2 id=methods>Methods</h2><ul><li><p>Methods can be defined for any named type (except a pointer or an interface); <strong>the receiver does not have to be a struct.</strong><figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=keyword>type</span> ByteSlice []<span class=type>byte</span></span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=params>(slice ByteSlice)</span></span> Append(data []<span class=type>byte</span>) []<span class=type>byte</span> {</span><br><span class=line>    <span class=comment>// Body exactly the same as the Append function defined above.</span></span><br><span class=line>}</span><br></pre></table></figure><p><li><p>The rule about pointers vs. values for receivers is that <strong>value methods can be invoked on pointers and values, but pointer methods can only be invoked on pointers</strong>.</ul><h2 id=interfaces-and-other-types>Interfaces and other types</h2><h3 id=interfaces>Interfaces</h3><ul><li><p>An interface is defined as <strong>a set of method signatures</strong>, and a type implements an interface by implementing its methods. <strong>A type can implement multiple interfaces</strong><figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br></pre><td class=code><pre><span class=line><span class=keyword>type</span> Sequence []<span class=type>int</span></span><br><span class=line></span><br><span class=line><span class=comment>// Methods required by sort.Interface.</span></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=params>(s Sequence)</span></span> Len() <span class=type>int</span> {</span><br><span class=line>    <span class=keyword>return</span> <span class=built_in>len</span>(s)</span><br><span class=line>}</span><br><span class=line><span class=function><span class=keyword>func</span> <span class=params>(s Sequence)</span></span> Less(i, j <span class=type>int</span>) <span class=type>bool</span> {</span><br><span class=line>    <span class=keyword>return</span> s[i] &lt; s[j]</span><br><span class=line>}</span><br><span class=line><span class=function><span class=keyword>func</span> <span class=params>(s Sequence)</span></span> Swap(i, j <span class=type>int</span>) {</span><br><span class=line>    s[i], s[j] = s[j], s[i]</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>You can define your own interface and <strong>a value of interface type can hold any value that implements those methods</strong>.<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br></pre><td class=code><pre><span class=line><span class=keyword>type</span> Abser <span class=keyword>interface</span> {</span><br><span class=line>	Abs() <span class=type>float64</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=keyword>type</span> MyFloat <span class=type>float64</span></span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=params>(f MyFloat)</span></span> Abs() <span class=type>float64</span> {</span><br><span class=line>	<span class=keyword>if</span> f &lt; <span class=number>0</span> {</span><br><span class=line>		<span class=keyword>return</span> <span class=type>float64</span>(-f)</span><br><span class=line>	}</span><br><span class=line>	<span class=keyword>return</span> <span class=type>float64</span>(f)</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>main</span><span class=params>()</span></span> {</span><br><span class=line>	<span class=keyword>var</span> a Abser</span><br><span class=line>	f := MyFloat(-math.Sqrt2)</span><br><span class=line>	a = f  <span class=comment>// a MyFloat implements Abser</span></span><br><span class=line>	fmt.Println(a.Abs())</span><br><span class=line>}</span><br></pre></table></figure><p></ul><h2 id=concurrency>Concurrency</h2><h3 id=share-by-communicating>Share by communicating</h3><ul><li><p>Concurrent programming in many environments is made difficult by the subtleties required to implement correct access to shared variables.<li><p>Go encourages a different approach in which <strong>shared values are passed around on channels and, in fact, never actively shared by separate threads of execution，only one goroutine has access to the value at any given time</strong>.<li><p>For example，Reference counts may be best done by putting a mutex around an integer variable. But as a high-level approach, using channels to control access makes it easier to write clear, correct programs.</ul><h3 id=goroutines>Goroutines</h3><ul><li><p>A goroutine has a simple model: it is a function executing concurrently with other goroutines in the <strong>same address space</strong>.<li><p>Prefix a function or method call with the <code>go</code> keyword to run the call in a new goroutine. When the call completes, <strong>the goroutine exits silently</strong>，don't wait for it.</ul><h3 id=channels>Channels</h3><ul><li><p>Like maps, channels are allocated with <code>make</code>, and the resulting value acts as a <strong>reference to an underlying data structure</strong><li><p>There are lots of nice idioms using channels. For example, if we launched a sort in the background and do sth else while waiting for the goroutine to finish. A channel allows us to do so<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line>c := <span class=built_in>make</span>(<span class=keyword>chan</span> <span class=type>int</span>)  <span class=comment>// Allocate a channel.</span></span><br><span class=line><span class=comment>// Start the sort in a goroutine; when it completes, signal on the channel.</span></span><br><span class=line><span class=keyword>go</span> <span class=function><span class=keyword>func</span><span class=params>()</span></span> {</span><br><span class=line>    list.Sort()</span><br><span class=line>    c &lt;- <span class=number>1</span>  <span class=comment>// Send a signal; value does not matter.</span></span><br><span class=line>}()</span><br><span class=line>doSomethingForAWhile()</span><br><span class=line>&lt;-c   <span class=comment>// Wait for sort to finish; discard sent value.</span></span><br></pre></table></figure><p><li><p>The above code works becase <strong>receivers always block until there is data to receive</strong>. As for the sender, if the channel is unbuffered, the sender blocks until the receiver has received the value. If the channel has a buffer, the sender blocks only until the value has been copied to the buffer; if the buffer is full, this means waiting until some receiver has retrieved a value.<li><p><strong>A buffered channel can be used like a semaphore</strong>, for instance to limit throughput. In the following example, incoming requests are passed to handle, which sends a value into the channel, processes the request, and then receives a value from the channel to ready the “semaphore” for the next consumer. <strong>The capacity of the channel buffer limits the number of simultaneous calls to process.</strong><figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre><td class=code><pre><span class=line><span class=keyword>var</span> sem = <span class=built_in>make</span>(<span class=keyword>chan</span> <span class=type>int</span>, MaxOutstanding)</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>handle</span><span class=params>(r *Request)</span></span> {</span><br><span class=line>    sem &lt;- <span class=number>1</span>    <span class=comment>// Wait for active queue to drain.</span></span><br><span class=line>    process(r)  <span class=comment>// May take a long time.</span></span><br><span class=line>    &lt;-sem       <span class=comment>// Done; enable next request to run.</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>Serve</span><span class=params>(queue <span class=keyword>chan</span> *Request)</span></span> {</span><br><span class=line>    <span class=keyword>for</span> {</span><br><span class=line>        req := &lt;-queue</span><br><span class=line>        <span class=keyword>go</span> handle(req)  <span class=comment>// Don't wait for handle to finish.</span></span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>The above design has a problem: Serve creates a new goroutine for every incoming request, even though only MaxOutstanding of them can run at any moment. As a result, <strong>the program can consume unlimited resources if the requests come in too fast</strong>. We can address that deficiency by changing Serve to gate the creation of the goroutines.<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>Serve</span><span class=params>(queue <span class=keyword>chan</span> *Request)</span></span> {</span><br><span class=line>    <span class=keyword>for</span> req := <span class=keyword>range</span> queue {</span><br><span class=line>        sem &lt;- <span class=number>1</span></span><br><span class=line>        <span class=keyword>go</span> <span class=function><span class=keyword>func</span><span class=params>()</span></span> {</span><br><span class=line>            process(req) <span class=comment>// Buggy; see explanation below.</span></span><br><span class=line>            &lt;-sem</span><br><span class=line>        }()</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>The bug in the above code is that <strong>in a Go <code>for</code> loop, the loop variable is reused for each iteration, so the req variable is shared across all goroutines</strong>. But we need to make sure that req is unique for each goroutine. Here's one way to do that, <strong>passing the value of req as an argument to the closure in the goroutine</strong>:<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>Serve</span><span class=params>(queue <span class=keyword>chan</span> *Request)</span></span> {</span><br><span class=line>    <span class=keyword>for</span> req := <span class=keyword>range</span> queue {</span><br><span class=line>        sem &lt;- <span class=number>1</span></span><br><span class=line>        <span class=keyword>go</span> <span class=function><span class=keyword>func</span><span class=params>(req *Request)</span></span> {</span><br><span class=line>            process(req)</span><br><span class=line>            &lt;-sem</span><br><span class=line>        }(req)</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>Another solution is just to create a new variable with the same name, like the following code, <code>req := req</code> may seem odd, but it's legal and idiomatic in Go to do this. You get a fresh version of the variable with the same name<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>Serve</span><span class=params>(queue <span class=keyword>chan</span> *Request)</span></span> {</span><br><span class=line>    <span class=keyword>for</span> req := <span class=keyword>range</span> queue {</span><br><span class=line>        req := req <span class=comment>// Create new instance of req for the goroutine.</span></span><br><span class=line>        sem &lt;- <span class=number>1</span></span><br><span class=line>        <span class=keyword>go</span> <span class=function><span class=keyword>func</span><span class=params>()</span></span> {</span><br><span class=line>            process(req)</span><br><span class=line>            &lt;-sem</span><br><span class=line>        }()</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>Another approach that manages resources well is to <strong>start a fixed number of handle goroutines all reading from the request channel</strong>. The number of goroutines limits the number of simultaneous calls to process.<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>handle</span><span class=params>(queue <span class=keyword>chan</span> *Request)</span></span> {</span><br><span class=line>    <span class=keyword>for</span> r := <span class=keyword>range</span> queue {</span><br><span class=line>        process(r)</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>Serve</span><span class=params>(clientRequests <span class=keyword>chan</span> *Request, quit <span class=keyword>chan</span> <span class=type>bool</span>)</span></span> {</span><br><span class=line>    <span class=comment>// Start handlers</span></span><br><span class=line>    <span class=keyword>for</span> i := <span class=number>0</span>; i &lt; MaxOutstanding; i++ {</span><br><span class=line>        <span class=keyword>go</span> handle(clientRequests)</span><br><span class=line>    }</span><br><span class=line>    &lt;-quit  <span class=comment>// Wait to be told to exit.</span></span><br><span class=line>}</span><br></pre></table></figure><p></ul><h3 id=channels-of-channels>Channels of channels</h3><ul><li><p>In the example in the previous section, handle was an idealized handler for a request but we didn't define the type it was handling. <strong>If that type includes a channel on which to reply, each client can provide its own path for the answer</strong>.<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=keyword>type</span> Request <span class=keyword>struct</span> {</span><br><span class=line>    args        []<span class=type>int</span></span><br><span class=line>    f           <span class=function><span class=keyword>func</span><span class=params>([]<span class=type>int</span>)</span></span> <span class=type>int</span></span><br><span class=line>    resultChan  <span class=keyword>chan</span> <span class=type>int</span></span><br><span class=line>}</span><br></pre></table></figure><p><li><p>The client provides a function and its arguments, as well as a channel inside the request object on which to receive the answer.<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>sum</span><span class=params>(a []<span class=type>int</span>)</span></span> (s <span class=type>int</span>) {</span><br><span class=line>    <span class=keyword>for</span> _, v := <span class=keyword>range</span> a {</span><br><span class=line>        s += v</span><br><span class=line>    }</span><br><span class=line>    <span class=keyword>return</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line>request := &Request{[]<span class=type>int</span>{<span class=number>3</span>, <span class=number>4</span>, <span class=number>5</span>}, sum, <span class=built_in>make</span>(<span class=keyword>chan</span> <span class=type>int</span>)}</span><br><span class=line><span class=comment>// Send request</span></span><br><span class=line>clientRequests &lt;- request</span><br></pre></table></figure><p><li><p>On the server side, the handler function is the only thing that changes.<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>handle</span><span class=params>(queue <span class=keyword>chan</span> *Request)</span></span> {</span><br><span class=line>    <span class=keyword>for</span> req := <span class=keyword>range</span> queue {</span><br><span class=line>        req.resultChan &lt;- req.f(req.args)</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p></ul><h2 id=errors>Errors</h2><ul><li><p>Library routines must often return some sort of error indication to the caller, it is easy to return a detailed error description alongside the normal return value with Go's multivalue return feature<li><p>Type <code>error</code> is a simple built-in interface, and library writer is free to implement this interface with a richer model under the covers, making it possible not only to see the error but also to provide some context<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br></pre><td class=code><pre><span class=line><span class=comment>// built-in error interface</span></span><br><span class=line><span class=keyword>type</span> <span class=type>error</span> <span class=keyword>interface</span> {</span><br><span class=line>    Error() <span class=type>string</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>// custom error</span></span><br><span class=line><span class=comment>// PathError records an error and the operation and</span></span><br><span class=line><span class=comment>// file path that caused it.</span></span><br><span class=line><span class=keyword>type</span> PathError <span class=keyword>struct</span> {</span><br><span class=line>    Op <span class=type>string</span>    <span class=comment>// "open", "unlink", etc.</span></span><br><span class=line>    Path <span class=type>string</span>  <span class=comment>// The associated file.</span></span><br><span class=line>    Err <span class=type>error</span>    <span class=comment>// Returned by the system call.</span></span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=params>(e *PathError)</span></span> Error() <span class=type>string</span> {</span><br><span class=line>    <span class=keyword>return</span> e.Op + <span class=string>" "</span> + e.Path + <span class=string>": "</span> + e.Err.Error()</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=comment>// PathError's Error will generate a string like this:</span></span><br><span class=line><span class=comment>// open /etc/passwx: no such file or directory</span></span><br></pre></table></figure><p><li><p>The usual way to report an error to a caller is to return an error as an extra return value, but sometimes <strong>the error is unrecoverable</strong>, the program simply cannot continue. We can use the built-in function <code>panic</code> in this case<li><p><strong><code>panic</code> function takes a single argument of arbitrary type—often a string—to be printed as the program dies</strong>. It's also a way to indicate that something impossible has happened, for example,it is reasonable to use <code>panic</code> with the failure of initialization,<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br></pre><td class=code><pre><span class=line><span class=keyword>var</span> user = os.Getenv(<span class=string>"USER"</span>)</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>init</span><span class=params>()</span></span> {</span><br><span class=line>    <span class=keyword>if</span> user == <span class=string>""</span> {</span><br><span class=line>        <span class=built_in>panic</span>(<span class=string>"no value for $USER"</span>)</span><br><span class=line>    }</span><br><span class=line>}</span><br></pre></table></figure><p><li><p>When <code>panic</code> is called, including implicitly for run-time errors such as indexing a slice out of bounds or failing a type assertion, it immediately <strong>stops execution of the current function and begins unwinding the stack of the goroutine, running any deferred functions along the way.</strong> If that unwinding reaches the top of the goroutine's stack, the program dies. But it is possible to <strong>use the built-in function <code>recover</code> to regain control of the goroutine and resume normal execution.</strong><li><p>A call to <code>recover</code> stops the unwinding and returns the argument passed to <code>panic</code>. Because the only code that runs while unwinding is inside deferred functions, <strong><code>recover</code> is only useful inside deferred functions.</strong><li><p><strong>One application of <code>recover</code> is to shut down a failing goroutine inside a server without killing the other executing goroutines.</strong> In this example, if <code>do(work)</code> panics, the result will be logged and the goroutine will exit cleanly without disturbing the others<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br></pre><td class=code><pre><span class=line><span class=function><span class=keyword>func</span> <span class=title>server</span><span class=params>(workChan &lt;-<span class=keyword>chan</span> *Work)</span></span> {</span><br><span class=line>    <span class=keyword>for</span> work := <span class=keyword>range</span> workChan {</span><br><span class=line>        <span class=keyword>go</span> safelyDo(work)</span><br><span class=line>    }</span><br><span class=line>}</span><br><span class=line></span><br><span class=line><span class=function><span class=keyword>func</span> <span class=title>safelyDo</span><span class=params>(work *Work)</span></span> {</span><br><span class=line>    <span class=keyword>defer</span> <span class=function><span class=keyword>func</span><span class=params>()</span></span> {</span><br><span class=line>        <span class=keyword>if</span> err := <span class=built_in>recover</span>(); err != <span class=literal>nil</span> {</span><br><span class=line>            log.Println(<span class=string>"work failed:"</span>, err)</span><br><span class=line>        }</span><br><span class=line>    }()</span><br><span class=line>    do(work)</span><br><span class=line>}</span><br></pre></table></figure><p></ul><h2 id=some-syntax>Some Syntax</h2><ul><li><p><code>int(math.Pow(float64(x), float64(count)))</code><li><p><code>Atoi</code> (string to int) and <code>Itoa</code> (int to string).<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre><td class=code><pre><span class=line>i, err := strconv.Atoi(<span class=string>"-42"</span>)</span><br><span class=line>s := strconv.Itoa(<span class=number>-42</span>)</span><br></pre></table></figure><p><li><p>concate string <code>s1</code> and <code>s2</code><figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre><td class=code><pre><span class=line>buffer := bytes.NewBufferString(s1)</span><br><span class=line>buffer.WriteString(s2)</span><br><span class=line>buffer.String()</span><br></pre></table></figure><p><li><p><code>append</code> function<figure class="highlight golang"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre><td class=code><pre><span class=line><span class=comment>// append multiple elements</span></span><br><span class=line>x := []<span class=type>int</span>{<span class=number>1</span>,<span class=number>2</span>,<span class=number>3</span>}</span><br><span class=line>x = <span class=built_in>append</span>(x, <span class=number>4</span>, <span class=number>5</span>, <span class=number>6</span>)</span><br><span class=line></span><br><span class=line><span class=comment>// append a slice </span></span><br><span class=line>x := []<span class=type>int</span>{<span class=number>1</span>,<span class=number>2</span>,<span class=number>3</span>}</span><br><span class=line>y := []<span class=type>int</span>{<span class=number>4</span>,<span class=number>5</span>,<span class=number>6</span>}</span><br><span class=line>x = <span class=built_in>append</span>(x, y...)</span><br></pre></table></figure><p></ul></div><footer class=post-footer><div class=post-copyright><ul><li class=post-copyright-author><strong>本文作者： </strong>良超<li class=post-copyright-link><strong>本文链接：</strong> <a title="Effective Go 摘记" href=https://wulc.me/2019/02/18/Effective%20Go%20%E6%91%98%E8%AE%B0/>https://wulc.me/2019/02/18/Effective Go 摘记/</a><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8=" class=exturl><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议。转载请注明出处！</ul></div><div class=post-tags><a href=/tags/go/ rel=tag><i class="fa fa-tag"></i> go</a></div><div class=post-nav><div class=post-nav-item><a title="文本分类中的一些经验和 tricks" href=/2019/02/06/%E6%96%87%E6%9C%AC%E5%88%86%E7%B1%BB%E4%B8%AD%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%8F%E9%AA%8C%E5%92%8C%20tricks/ rel=prev> <i class="fa fa-angle-left"></i> 文本分类中的一些经验和 tricks </a></div><div class=post-nav-item><a title="Adam 那么棒，为什么还对 SGD 念念不忘" href=/2019/03/18/Adam%E9%82%A3%E4%B9%88%E6%A3%92%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%98%E5%AF%B9SGD%E5%BF%B5%E5%BF%B5%E4%B8%8D%E5%BF%98/ rel=next> Adam 那么棒，为什么还对 SGD 念念不忘 <i class="fa fa-angle-right"></i> </a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>© 2015 – <span itemprop=copyrightYear>2026</span><span class=with-love> <i class="fa fa-pen"></i> </span><span class=author itemprop=copyrightHolder>良超</span></div><div class=powered-by>由 <span class=exturl data-url=aHR0cHM6Ly9oZXhvLmlv>Hexo</span> & <span class=exturl data-url=aHR0cHM6Ly90aGVtZS1uZXh0LmpzLm9yZy9waXNjZXMv>NexT.Pisces</span> 强力驱动</div><!-- 51LA 网站统计 --><script charset=UTF-8 id=LA_COLLECT src=https://sdk.51.la/js-sdk-pro.min.js></script><script>LA.init({id: "JmI6QmP3fMkLet6B",ck: "JmI6QmP3fMkLet6B"})</script></div></footer><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span><span class=toggle-line></span><span class=toggle-line></span></div><div class=sidebar-dimmer></div><div aria-label=返回顶部 class=back-to-top role=button><i class="fa fa-arrow-up fa-lg"></i><span>0%</span></div><div class=reading-progress-bar></div><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript>